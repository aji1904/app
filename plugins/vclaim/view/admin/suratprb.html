<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span> Tutup</button>
    <h4 class="modal-title">Riwayat Program Rujuk Balik</h4>
</div>
<div class="modal-body">

  <div id="form_prb">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-body">
          <div class="row clearfix">
              <div class="col-md-6">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" id="email" class="form-control"  required/>
                </div>
              </div>
              <div class="col-md-6">
                  <div class="form-group">
                      <label>Program PRB</label>
                      <select class="form-control" name="poli" id="poli" data-use-search="true" required>
                        {loop: $diagnosa_prb}
                        <option value="{$value.kode}">{$value.nama}</option>
                        {/loop}
                      </select>
                  </div>
              </div>
              <div class="col-md-6">
                  <div class="form-group">
                      <label>Keterangan</label>
                      <input type="text" name="keterangan" class="form-control" />
                  </div>
              </div>
              <div class="col-md-6">
                  <div class="form-group">
                      <label>Saran</label>
                      <input type="text" name="saran" class="form-control" />
                  </div>
              </div>
          </div>
          <div class="row clearfix">
              <div class="col-md-12">
                  <button type="button" class="btn btn-primary" id="simpan_spri">Simpan</button>
                  <button type="button" class="btn btn-primary" id="load_spri">Load</button>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <br><br>

  <div id="spridisplay">
  </div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-primary" data-dismiss="modal">Tutup</button>
</div>
<script type="text/javascript">
   $('select').selectator();
   $(function () {
       $('.tanggal').datetimepicker({
         format: 'YYYY-MM-DD',
         locale: 'id'
       });
   });
   $(function () {
       $('.jam').datetimepicker({
         format: 'HH:mm:ss',
         locale: 'id'
       });
   });
</script>
<script type="text/javascript">
  $("#form_spri").on("click","#load_spri", function(event){
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    $("#spridisplay").show().load(baseURL + '/vclaim/spridisplay/{$no_kartu}/{?=convertNorawat($no_rawat)?}?t=' + mlite.token);
  });

  $(document).ready(function() {
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    $("#spridisplay").show().load(baseURL + '/vclaim/spridisplay/{$no_kartu}/{?=convertNorawat($no_rawat)?}?t=' + mlite.token);
  });

  $("#form_spri").on("click","#diagnosaprb", function(){
    var query = $(this).val();
    var sep_pelayanan_kode = $('input:text[name=sep_pelayanan_kode]').val();
    var sep_tanggal_sep = $('input:text[name=sep_tanggal_sep]').val();

    if(query != '')
    {
      $.ajax({
        url: '{?=url()?}/admin/vclaim/diagnosaprb',
        method:"GET",
        data:{},
        success:function(data)
        {
            var data = JSON.parse(data);
            var json_obj = [data];
            var output='';
            if(json_obj[0].metaData.code == 200) {
              var dokterdpjp = json_obj[0].response.list;
              for (var i in dokterdpjp) {
                output+='<li class=\"list-group-item link-class\">' + dokterdpjp[i].kode + ': ' + dokterdpjp[i].nama + '</li>';
              }
            } else {
              output+='<li class=\"list-group-item link-class\">' + json_obj[0].metaData.message + '</li>';
            }
            output+='';
            //console.log(output);
            $('#dokterdpjpList').fadeIn();
            $('#dokterdpjpList').html(output).show();
        }
      });
    }
  })

  $("#form_spri").on("click","#simpan_spri", function(event){
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();

    var tanggal_surat   = $('#tanggal_rujukan').val();
    var tanggal_periksa = $('#tanggal_datang').val();
    var poli            = $('#poli').val();
    var dokter          = $('#dokter').val();

    var url = baseURL + '/vclaim/savespri/{$no_kartu}/{?=convertNorawat($no_rawat)?}?t=' + mlite.token;

    $.post(url,{
      tanggal_surat : tanggal_surat,
      tanggal_periksa : tanggal_periksa,
      dokter : dokter,
      poli : poli
    } ,function(data) {
      $("#spridisplay").show().load(baseURL + '/vclaim/spridisplay/{$no_kartu}/{?=convertNorawat($no_rawat)?}?t=' + mlite.token);
      if (data == "") {
        Swal.fire(
          'Good job!',
          'SPRI berhasil disimpan',
          'success'
        )
      } else {
        Swal.fire(
          'Good job!',
          data,
          'success'
        )
      }
    });

  });

  $("#spridisplay").on("click", ".pilih_nosurat", function(event){
    var no_surat = $(this).attr("data-no_surat");
    $('input:text[name=sep_nomor_skdp]').val(no_surat);
    $('#spriModal').modal('hide');
  });
</script>
