<!DOCTYPE html>
<html lang="en">
<head>
  <title>SJP</title>
  <script>
    function printContent(el){
      var restorepage = document.body.innerHTML;
      var printcontent = document.getElementById(el).innerHTML;
      document.body.innerHTML = printcontent;
      window.print();
      document.body.innerHTML = restorepage;
      window.close();
    }
    </script>
    
</head>

<body>
  {if: isset($data_sep.no_sep)}
  <div id="cetaksep">
    <style  type="text/css">
      html {
        font-size:16px;
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      table td {
        font-size:16px;
        padding: 0;
      }
      .cetak {
    		display:inline-block;
    		padding:6px 12px;
    		margin:10px;
    		font-size:14px;
    		font-weight:400;
    		line-height:1.5;
    		white-space:nowrap;
        float: right;
        bottom: 10px;
        right: 10px;
    	}
      .tutup {
    		display:inline-block;
    		padding:6px 12px;
        margin:10px;
    		font-size:14px;
    		font-weight:400;
    		line-height:1.5;
    		white-space:nowrap;
        float: right;
        bottom: 10px;
        right: 10px;
    	}
      .btn {
    		display:inline-block;
    		padding:6px 12px;
        margin:10px;
    		font-size:14px;
    		font-weight:400;
    		line-height:1.5;
    		white-space:nowrap;
        bottom: 10px;
        right: 10px;
    	}
      .box1 {
        width: 13px;
        height: 13px;
        border: 1px solid;
      }
    </style>
    <table width="1000">
      <tr>
        <td>
          <table>
            <tr align="center">
              <td width="1000">
                <div style="font-size:25px;text-align:center;">
                  {$settings.nama_instansi}
                </div>
                <div style="font-size:25px;text-align:center;">
                  SURAT JAMINAN PELAYANAN BPJS RAWAT {if: $data_sep.jnspelayanan == '2' }JALAN{else}INAP{/if}
                </div>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="420">
              </br>
              </td>
              <td width="580">
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="100">
                No. SEP
              </td>
              <td>
                :
              </td>
              <td width="400">
                {$data_sep.no_sep}
              </td>
              <td width="100">
                No. SJP
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.no_rawat}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="100">
                Tgl. SEP
              </td>
              <td>
                :
              </td>
              <td width="400">
                {$data_sep.tglsep}
              </td>
              <td width="100">
                Tgl. SJP
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.tglsep}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="100">
                No. Kartu
              </td>
              <td>
                :
              </td>
              <td width="400">
                {$data_sep.no_kartu} ( MR: {$data_sep.nomr} )
              </td>
              <td width="100">
                Tgl. Lahir
              </td>
              <td>
                :
              </td>
              <td>
                {$data_sep.tanggal_lahir}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="100">
                No. Rujukan
              </td>
              <td>
                :
              </td>
              <td width="400">
                {$data_sep.no_rujukan}
              </td>
              <td width="100">
                Nama
              </td>
              <td>
                :
              </td>
              <td style="max-width: 300px; width: 300px;">
                {$data_sep.nama_pasien}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="100">
                Tgl. Rujukan
              </td>
              <td>
                :
              </td>
              <td width="400">
                {$data_sep.tglsep}
              </td>
              <td width="100">
                Jns Kelamin
              </td>
              <td>
                :
              </td>
              <td>
                {if: $data_sep.jkel == 'L'}LAKI-LAKI{else}PEREMPUAN{/if}
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
        <br>
        Penunjang
        </td>
      </tr>
      <tr>
        <table>
          <tr>
            <td width="200">
              <div class="box1"><font style="padding-left: 20px;">LABORATORIUM</font></div>
            </td>
            <td width="200">
              <div class="box1"><font style="padding-left: 20px;">RADIOLOGI</font></div>
            </td>
            <td width="200">
              <div class="box1"><font style="padding-left: 20px;">USG</font></div>
            </td>
            <td width="200">
              <div class="box1"><font style="padding-left: 20px;">EKG</font></div></td>
            </td>
          </tr>
          <tr>
            <td>
              </br>
              <div class="box1"><font style="padding-left: 20px;">FISIOTERAPI</font></div>
            </td>
            <td>
              </br>
              <div class="box1"><font style="padding-left: 20px;">ECHOCARDIOGRAPH</font></div>
            </td>
            <td>
              </br>
              <div class="box1"><font style="padding-left: 20px;">TREADMIL</font></div>
            </td>
            <td>
              </br>
              <div class="box1"><font style="padding-left: 20px;">LAINNYA........</font></div>
            </td>
          </tr>
        </table>
        <br><br>
      </tr>
      <tr>
        <td>
          <table>
            <tr>
              <td width="900">
                <font style="font-weight: bold;">Diagnosa Utama</font>
              </td>
              <td>
                <font style="font-weight: bold;">ICD 10</font>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <br><br>
        </td>
        <div style="border: 1px solid; width: 900px;"></div>
      </tr>
      <tr>
        <td>
          <br>
          <table>
            <tr>
              <td width="900">
                <font style="font-weight: bold;">Diagnosa Sekunder</font>
              </td>
              <td>
                <font style="font-weight: bold;">ICD 10</font>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <br><br>
        </td>
        <div style="border: 1px solid; width: 900px;"></div>
        <td>
          <br><br>
        </td>
        <div style="border: 1px solid; width: 900px;"></div>
      </tr>
      <tr>
        <td>
          <br>
          <table>
            <tr>
              <td width="900">
                <font style="font-weight: bold;">Tindakan</font>
              </td>
              <td>
                <font style="font-weight: bold;">ICD 9</font>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <br><br>
        </td>
        <div style="border: 1px solid; width: 900px;"></div>
        <br>
      </tr>

      <tr>
        <table>
          <tr style="text-align: center;">
            <td width="230">Pasien/Keluarga</td>
            <td width="230">Verifikator RS</td>
            <td width="230">Dokter DPJP</td>
            <td width="230">Verifikator BPJS</td>
          </tr>
          <tr>
            <td><br><br></td>
          </tr>
          <tr style="text-align: center;">
            <td width="230">________________</td>
            <td width="230">________________</td>
            <td width="230">________________</td>
            <td width="230">________________</td>
          </tr>
        </table>
      </tr>
      <tr>
        <br><br><br>
        <table>
          <tr>
            <td width="100">No. Resep</td>
            <td> : </td>
            <td width="300"></td>
            <td>Dokter</td>
            <td> : </td>
            <td>{$data_sep.nmdpdjp}</td>

          </tr>
          <tr>
            <td>Tgl. Resep</td>
            <td> : </td>
            <td>{$data_sep.tglsep}</td>
            <td>Total biaya resep</td>
            <td> : </td>
            <td></td>

          </tr>
        </table>
      </tr>

    
      
    </table>
  </div>
  <center style="margin-top:100px;">
    <button class="tutup" type="button" onclick="javascript:window.close();opener.window.focus();">Tutup Window</button>
    <button class="cetak" onclick="printContent('cetaksep')" type="button">Cetak SJP</button>
  </center>
  {else}
    <center>
      <div class="alert alert-danger" id="sync">
        Data SEP <span id="no_sep">{?=parseURL()[2]?}</span> di server SIMRS tidak ditemukan.<br>
        Apakah akan menarik data dari v-Claim?<br>
        <button class="btn" type="button" id="syncsep">Ya</button>
        <button class="btn" type="button" onclick="javascript:window.close();opener.window.focus();">TUTUP</button>
      </div>
    </center>
    <div id="carisep">
      <pre>
      </pre>
    </div>
    <div id="caribynorujukan">
      <pre>
      </pre>
    </div>
    <script src="{?=url()?}/assets/jscripts/jquery.min.js"></script>
    <script type="text/javascript" src="{?=url()?}/assets/jscripts/jquery.qrcode.js"></script>
    <script type="text/javascript" src="{?=url()?}/assets/jscripts/qrcode.js"></script>
    <script>
          var mlite = {token:"{$_SESSION['token']}", url:"{?=url()?}", admin:"{?=ADMIN?}"};
          $('#syncsep').on('click',function(e){
            var baseURL = mlite.url + '/' + mlite.admin;
            event.preventDefault();
            $.get("{?=url([ADMIN, 'vclaim', 'carisep', parseURL()[2]])?}", function(data){
              var data = JSON.parse(data);
              $("#carisep pre").text(JSON.stringify(data, null, '\t'));
              var json_obj = [data];
              if(!json_obj[0]) {
                alert('Koneksi ke server BPJS terputus. Silahkan ulangi lagi!');
              } else if(json_obj[0].metaData.code == 200) {

                $.get(baseURL + '/vclaim/caribynorujukan/PCare/' + json_obj[0].response.noRujukan + '?t=' + mlite.token, function(data){
                  var data = JSON.parse(data);
                  $("#caribynorujukan pre").text(JSON.stringify(data, null, '\t'));
                  var json_obj2 = [data];
                  if(!json_obj2[0]) {
                    alert('Koneksi ke server BPJS terputus. Silahkan ulangi lagi!');
                  } else if(json_obj2[0].metaData.code == 200) {
                    alert(json_obj2[0].metaData.message);

                    var no_sep = json_obj[0].response.noSep;
                    var no_rawat = '';
                    var tglsep = json_obj[0].response.tglSep;
                    var tglrujukan = json_obj2[0].response.rujukan.tglKunjungan;
                    var no_rujukan = json_obj[0].response.noRujukan;
                    var kdppkrujukan = json_obj2[0].response.rujukan.provPerujuk.kode;
                    var nmppkrujukan = json_obj2[0].response.rujukan.provPerujuk.nama;
                    var jnspelayanan = json_obj2[0].response.rujukan.pelayanan.kode;
                    var catatan = json_obj[0].response.catatan;
                    var diagawal = json_obj2[0].response.rujukan.diagnosa.kode;
                    var nmdiagnosaawal = json_obj2[0].response.rujukan.diagnosa.nama;
                    var kdpolitujuan = '';
                    var nmpolitujuan = '';
                    var klsrawat = '';
                    var lakalantas = '';
                    var user = '';
                    var nomr = '';
                    var nama_pasien = '';
                    var tanggal_lahir = '';
                    var peserta = '';
                    var jkel = '';
                    var no_kartu = json_obj2[0].response.rujukan.peserta.noKartu;;
                    var tglpulang = '';
                    var asal_rujukan = '';
                    var eksekutif = '';
                    var cob = '';
                    var penjamin = '';
                    var notelep = '';
                    var katarak = '';
                    var tglkkl = '';
                    var keterangankkl = '';
                    var suplesi = '';
                    var no_sep_suplesi = '';
                    var kdprop = '';
                    var nmprop = '';
                    var kdkab = '';
                    var nmkab = '';
                    var kdkec = '';
                    var nmkec = '';
                    var noskdp = '';
                    var kddpjp = '';
                    var nmdpdjp = '';

                    $.ajax({
                      type: "POST",
                      url: "{?=url([ADMIN,'vclaim','syncsep'])?}",
                      data: {
                        no_sep: no_sep,
                        tglsep: tglsep,
                        tglrujukan: tglrujukan,
                        no_rujukan: no_rujukan,
                        kdppkrujukan: kdppkrujukan,
                        nmppkrujukan: nmppkrujukan,
                        jnspelayanan: jnspelayanan,
                        catatan: catatan,
                        diagawal: diagawal,
                        nmdiagnosaawal: nmdiagnosaawal,
                        kdpolitujuan: kdpolitujuan,
                        nmpolitujuan: nmpolitujuan,
                        klsrawa: klsrawat,
                        lakalantas: lakalantas,
                        user: user,
                        nomr: nomr,
                        nama_pasien: nama_pasien,
                        tanggal_lahir: tanggal_lahir,
                        peserta: peserta,
                        jkel: jkel,
                        no_kartu: no_kartu,
                        tglpulang: tglpulang,
                        asal_rujukan: asal_rujukan,
                        eksekutif: eksekutif,
                        cob: cob,
                        penjamin: penjamin,
                        notelep: notelep,
                        katarak: katarak,
                        tglkkl: tglkkl,
                        keterangankkl: keterangankkl,
                        suplesi: suplesi,
                        no_sep_suplesi: no_sep_suplesi,
                        kdprop: kdprop,
                        nmprop: nmprop,
                        kdkab: kdkab,
                        nmkab: nmkab,
                        kdkec: kdkec,
                        nmkec: nmkec,
                        noskdp: noskdp,
                        kddpjp: kddpjp,
                        nmdpdjp: nmdpdjp
                      },
                      success: function(result){
                        var messages = result.split(' ');
                        if (messages.length == 1) {
                          //location.reload();
                        } else if(messages.length > 1) {
                          alert(result)
                        } else {
                          alert('Gagal menyimpan data ke database SIMRS');
                        }
                      }
                    });

                  } else {
                    alert(json_obj[0].metaData.message);
                  }
                });
              } else {
                alert(json_obj[0].metaData.message);
              }
            });
          });
    </script>
  {/if}
</body>
</html>
